<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ğŸ’¡ ë²•ë¥  ìƒì‹ í€´ì¦ˆ ğŸ’¡</title>
<style>
:root{--primary-color:#007bff;--secondary-color:#6c757d;--success-color:#28a745;--danger-color:#dc3545;--warning-color:#ffc107;--font-color:#343a40;--background-color:#f8f9fa}body{font-family:'Segoe UI',Tahoma,Geneva,Verdana,sans-serif;background-color:var(--background-color);color:var(--font-color);line-height:1.6;margin:0;padding:20px;display:flex;flex-direction:column;align-items:center;min-height:100vh}.screen-container{width:100%;max-width:800px;background:white;padding:40px;border-radius:12px;box-shadow:0 4px 15px rgba(0,0,0,.1);text-align:center;display:none}.screen-container.active{display:block}h1{color:var(--primary-color);margin-bottom:30px}.btn{display:block;width:100%;max-width:400px;margin:10px auto;padding:15px;font-size:1.1em;border:none;border-radius:8px;cursor:pointer;transition:all .2s;color:white;font-weight:bold}.btn-primary{background-color:var(--primary-color)}.btn-success{background-color:var(--success-color)}.btn-secondary{background-color:var(--secondary-color)}.opacity-50{opacity:.5}.cursor-not-allowed{cursor:not-allowed}.hidden{display:none!important}#question-text{font-size:1.3em;font-weight:500;margin-bottom:20px;background-color:#f1f3f5;padding:20px;border-radius:8px;border-left:5px solid var(--primary-color);text-align:left}.option-button{display:block;width:100%;padding:15px;margin:10px 0;text-align:left;border:1px solid #ced4da;border-radius:8px;background-color:white;color:var(--font-color);font-size:1em;cursor:pointer}.option-button:hover:not([disabled]){background-color:#e9ecef;border-color:var(--primary-color)}.correct{background-color:#d4edda!important;border-color:var(--success-color)!important}.incorrect{background-color:#f8d7da!important;border-color:var(--danger-color)!important}#explanation-area{border-top:2px dashed var(--secondary-color);padding-top:20px;margin-top:25px;text-align:left}#feedback-message{font-size:1.2em;font-weight:bold;margin-bottom:15px;padding:10px;border-radius:5px;text-align:center}.feedback-correct{background-color:#d4edda;color:var(--success-color)}.feedback-incorrect{background-color:#f8d7da;color:var(--danger-color)}#explanation-content{white-space:pre-wrap;background-color:#fff3cd;padding:15px;border-radius:8px;border:1px solid var(--warning-color);color:#856404}.review-item{text-align:left;border:1px solid #dee2e6;border-radius:8px;padding:20px;margin-bottom:20px;background-color:#f8f9fa}
</style>
</head>
<body>

<div id="start-screen" class="screen-container active">
<h1>âš–ï¸ ë²•ë¥  ìƒì‹ í€´ì¦ˆ</h1>
<p style="margin-bottom:30px;font-size:1.1em">ë§¤ì¼ ìƒˆë¡œìš´ ë²•ë¥  ìƒì‹ì„ í€´ì¦ˆë¡œ ë°°ì›Œë³´ì„¸ìš”.<br>í•œ ì„¸íŠ¸ë‹¹ 5ë¬¸ì œê°€ ì¶œì œë©ë‹ˆë‹¤.</p>
<button id="newQuizSetBtnEl" class="btn btn-primary">âœ¨ ìƒˆ í€´ì¦ˆ ì„¸íŠ¸ ìƒì„±</button>
<button id="reviewBtnEl" class="btn btn-success" onclick="handleEnterReviewMode()">ğŸ“š ì§€ë‚œ ì˜¤ë‹µ ë³µìŠµí•˜ê¸°</button>
</div>

<div id="quiz-screen" class="screen-container">
<div style="display:flex;justify-content:space-between;margin-bottom:20px;border-bottom:2px solid #e9ecef;padding-bottom:10px;">
<div>ë¬¸ì œ: <span id="current-quiz-index">0</span> / <span id="total-quiz-count">0</span></div>
<div id="timer" style="font-weight:bold;color:var(--danger-color);border:2px solid var(--danger-color);padding:0 10px;border-radius:8px;">15s</div>
</div>
<div id="question-text"></div>
<div id="options-container"></div>
<div id="explanation-area" style="display:none;">
<div id="feedback-message"></div>
<h3>ğŸ” í•´ì„¤</h3>
<p id="explanation-content"></p>
</div>
<button id="next-button" class="btn btn-primary" style="display:none;">ë‹¤ìŒ ë¬¸ì œ</button>
</div>

<div id="result-screen" class="screen-container">
<h2>ğŸ‰ í€´ì¦ˆ ì™„ë£Œ!</h2>
<p>ì´ ì •ë‹µ: <strong id="final-correct-count"></strong> / <span id="final-total-count"></span></p>
<p>ì ìˆ˜: <strong id="final-score"></strong>ì </p>
<button class="btn btn-success" onclick="handleEnterReviewMode()">ğŸ“š ì˜¤ë‹µ ë…¸íŠ¸ í™•ì¸</button>
<button class="btn btn-secondary" onclick="location.reload()">ğŸ  ì²˜ìŒìœ¼ë¡œ ëŒì•„ê°€ê¸°</button>
</div>

<div id="review-screen" class="screen-container">
<h1>ğŸ“š ì˜¤ë‹µ ë…¸íŠ¸</h1>
<div id="review-list"></div>
<button class="btn btn-secondary" onclick="location.reload()">ğŸ  ì²˜ìŒìœ¼ë¡œ ëŒì•„ê°€ê¸°</button>
</div>

<script>
const QUIZ_API_URL = '/api/lawquizzes/new';
const STORAGE_KEY_QUIZZES = 'lawQuizzesData';
let allQuizzes=[],currentQuizIndex=0,correctCount=0,timerInterval,isAnswered=false;
const newQuizSetBtnEl=document.getElementById("newQuizSetBtnEl");

newQuizSetBtnEl.addEventListener("click",async()=>{
newQuizSetBtnEl.disabled=true;
newQuizSetBtnEl.classList.add("opacity-50","cursor-not-allowed");
newQuizSetBtnEl.textContent="í€´ì¦ˆ ìƒì„± ì¤‘... (ìµœëŒ€ 60ì´ˆ)";
try{
const res=await fetch(QUIZ_API_URL,{method:"POST"});
if(!res.ok){let errMessage=`ìƒˆ í€´ì¦ˆ ìƒì„± ì‹¤íŒ¨ (Status: ${res.status})`;try{const err=await res.json();errMessage=err.message||err.error||errMessage}catch(e){}throw new Error(errMessage)}
allQuizzes=await res.json();
if(!allQuizzes||allQuizzes.length===0)throw new Error("í€´ì¦ˆ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.");
localStorage.setItem(STORAGE_KEY_QUIZZES,JSON.stringify(allQuizzes));
currentQuizIndex=0;
correctCount=0;
startQuizFlow();
newQuizSetBtnEl.classList.add("hidden");
}catch(err){console.error(err);alert(`ìƒˆ í€´ì¦ˆ ì„¸íŠ¸ ìƒì„± ì¤‘ ì˜¤ë¥˜ ë°œìƒ: ${err.message}`)}finally{newQuizSetBtnEl.disabled=false;newQuizSetBtnEl.classList.remove("opacity-50","cursor-not-allowed");newQuizSetBtnEl.textContent="âœ¨ ìƒˆ í€´ì¦ˆ ì„¸íŠ¸ ìƒì„±"}});

function startQuizFlow(){document.querySelectorAll('.screen-container').forEach(el=>el.classList.remove('active'));document.getElementById('quiz-screen').classList.add('active');updateQuizUI()}
function updateQuizUI(){if(currentQuizIndex>=allQuizzes.length){showResults();return}isAnswered=false;document.getElementById('next-button').style.display='none';document.getElementById('explanation-area').style.display='none';const quiz=allQuizzes[currentQuizIndex];document.getElementById('current-quiz-index').textContent=currentQuizIndex+1;document.getElementById('total-quiz-count').textContent=allQuizzes.length;document.getElementById('question-text').innerHTML=`<span style="color: var(--secondary-color); font-size: 0.9em;">(${quiz.category})</span><br>${quiz.question}`;const container=document.getElementById('options-container');container.innerHTML='';quiz.options.forEach((option,idx)=>{const btn=document.createElement('button');btn.className='option-button';btn.textContent=`${idx+1}. ${option.text}`;btn.dataset.isCorrect=option.is_correct;btn.onclick=()=>checkAnswer(btn,quiz);container.appendChild(btn)});startTimer(quiz.timer_sec||15)}
function checkAnswer(selectedBtn,quiz){if(isAnswered)return;isAnswered=true;clearInterval(timerInterval);const isTimeUp=!selectedBtn;const isCorrect=isTimeUp?false:selectedBtn.dataset.isCorrect==='true';quiz.is_correct_answered=isCorrect;quiz.user_answer_text=isTimeUp?"â° ì‹œê°„ ì´ˆê³¼":selectedBtn.textContent;localStorage.setItem(STORAGE_KEY_QUIZZES,JSON.stringify(allQuizzes));const feedbackEl=document.getElementById('feedback-message');if(isCorrect){correctCount++;feedbackEl.textContent="âœ… ì •ë‹µì…ë‹ˆë‹¤!";feedbackEl.className='feedback-correct'}else{feedbackEl.textContent=isTimeUp?"â° ì‹œê°„ ì´ˆê³¼!":"âŒ ì˜¤ë‹µì…ë‹ˆë‹¤.";feedbackEl.className='feedback-incorrect';if(selectedBtn)selectedBtn.classList.add('incorrect')}document.querySelectorAll('.option-button').forEach(btn=>{btn.disabled=true;if(btn.dataset.isCorrect==='true')btn.classList.add('correct')});document.getElementById('explanation-content').textContent=quiz.explanation;document.getElementById('explanation-area').style.display='block';const nextBtn=document.getElementById('next-button');nextBtn.textContent=(currentQuizIndex<allQuizzes.length-1)?"ë‹¤ìŒ ë¬¸ì œ":"ê²°ê³¼ ë³´ê¸°";nextBtn.style.display='block';nextBtn.onclick=()=>{currentQuizIndex++;updateQuizUI()}}
function startTimer(seconds){let left=seconds;document.getElementById('timer').textContent=`${left}s`;if(timerInterval)clearInterval(timerInterval);timerInterval=setInterval(()=>{left--;document.getElementById('timer').textContent=`${left}s`;if(left<=0){clearInterval(timerInterval);if(!isAnswered)checkAnswer(null,allQuizzes[currentQuizIndex])}},1000)}
function showResults(){document.getElementById('quiz-screen').classList.remove('active');document.getElementById('result-screen').classList.add('active');document.getElementById('final-correct-count').textContent=correctCount;document.getElementById('final-total-count').textContent=allQuizzes.length;document.getElementById('final-score').textContent=Math.round((correctCount/allQuizzes.length)*100)}
function handleEnterReviewMode() {
  const stored = JSON.parse(localStorage.getItem(STORAGE_KEY_QUIZZES));
  if (!stored || stored.length === 0) {
    alert("ì €ì¥ëœ ê¸°ë¡ì´ ì—†ìŠµë‹ˆë‹¤.");
    return;
  }
  
  // ê¸°ì¡´ allQuizzesì™€ ìƒˆë¡œ ë¶ˆëŸ¬ì˜¨ storedë¥¼ í•©ì³ì„œ ëˆ„ì 
  const existingIds = new Set(allQuizzes.map(q => q.question));
  stored.forEach(q => {
    if (!existingIds.has(q.question)) {
      allQuizzes.push(q);
    }
  });
  
  document.querySelectorAll('.screen-container').forEach(el => el.classList.remove('active'));
  document.getElementById('review-screen').classList.add('active');
  const list = document.getElementById('review-list');
  list.innerHTML = '';
  const wrongs = allQuizzes.filter(q => q.is_correct_answered === false);
  if (wrongs.length === 0) {
    list.innerHTML = "<div>í‹€ë¦° ë¬¸ì œê°€ ì—†ìŠµë‹ˆë‹¤!</div>";
    return;
  }
  wrongs.forEach((q, idx) => {
    const correctOption = q.options.find(o => o.is_correct);
    const correctText = correctOption ? correctOption.text : "-";
    const div = document.createElement('div');
    div.className = 'review-item';
    div.innerHTML = `
      <h3>${idx + 1}. ${q.question}</h3>
      <p style='color:red'>ë‚´ ë‹µ: ${q.user_answer_text || '-'}</p>
      <p style='color:blue'>ì •ë‹µ: ${correctText}</p>
      <p>í•´ì„¤: ${q.explanation}</p>
    `;
    list.appendChild(div);
  });
  
  alert(`ì˜¤ë‹µ ë¬¸ì œ ${wrongs.length}ê°œê°€ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤.`);
}
</script>
</body>
</html>
